<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>SIMULATEUR: contour.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="files.html">File&nbsp;List</a>  | <span class="search"><u>S</u>earch&nbsp;for&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<h1>contour.cpp</h1><pre class="fragment"><div>00001 <span class="preprocessor">#include "module.h"</span>
00002 <span class="preprocessor">#include "systeme.h"</span>
00003 <span class="preprocessor">#include "senseur.h"</span>
00004 <span class="preprocessor">#include "contour.h"</span>
00005 <span class="preprocessor">#include "trace.h"</span>
00006 <span class="preprocessor">#include "tinyxml.h"</span>
00007 <span class="preprocessor">#include "geom2D.h"</span>
00008 <span class="preprocessor">#include "simulation.h"</span>
00009 <span class="preprocessor">#include &lt;math.h&gt;</span>
00010 <span class="keyword">using</span> <span class="keyword">namespace </span>std;
00011 
00012 Contour::Contour(Systeme *s,Trace * t):Senseur(s,t)
00013 {
00014   trace = t;
00015   src = <span class="stringliteral">"contour.cpp"</span>;
00016   cl = <span class="stringliteral">"Contour"</span>;
00017   message = <span class="stringliteral">"debut"</span>;
00018   trace-&gt;print(src,cl,<span class="stringliteral">"Contour"</span>,message);
00019     
00020   message = <span class="stringliteral">"fin"</span>;
00021   trace-&gt;print(src,cl,<span class="stringliteral">"Contour"</span>,message);
00022 }
00023 
00024 Contour::~Contour(<span class="keywordtype">void</span>)
00025 {
00026   message = <span class="stringliteral">"debut"</span>;
00027   trace-&gt;print(src,cl,<span class="stringliteral">"~Contour"</span>,message);
00028   vectorSegment2D::iterator it;
00029   <span class="keywordflow">for</span> (it = tabSegments_Contour.begin();it!=tabSegments_Contour.end();++it)
00030   {
00031     <span class="keyword">delete</span>(*it);
00032   }
00033 
00034   message = <span class="stringliteral">"fin"</span>;
00035   trace-&gt;print(src,cl,<span class="stringliteral">"~Contour"</span>,message);
00036 }
00037 
00038 <span class="keywordtype">void</span> Contour::execute(<span class="keywordtype">int</span> tempsCourant_ms)
00039 {
00040   message = <span class="stringliteral">"debut"</span>;
00041   trace-&gt;print(src,cl,<span class="stringliteral">"execute"</span>,message);
00042   
00043   vectorSegment2D contourReferentielTerrain;
00044   
00045   <span class="comment">//initialiser la liste des collisions avec des systemes et des obstacles</span>
00046   tabPointContacts_Obstacles.clear();
00047   tabPointContacts_Systemes.clear();
00048   tabSystemesEnContact.clear();
00049   
00050   <span class="comment">//calcul de la position absolue des segments du contour</span>
00051   vectorSegment2D::iterator it;
00052   Segment2D *seg;
00053   Segment2D *segRT;
00054   <span class="keywordflow">for</span> (it = tabSegments_Contour.begin();it!=tabSegments_Contour.end();++it)
00055   {
00056     seg = *it;
00057     segRT = seg-&gt;creeSegmentRT(positionCourante,attitudeCourante_rad);
00058     contourReferentielTerrain.push_back(segRT);
00059   }
00060 
00061   <span class="comment">//calcul de la boite associée au contour</span>
00062   Boite2D * boiteContourRT = <span class="keyword">new</span> Boite2D(contourReferentielTerrain);
00063 
00064   <span class="comment">//recherche dans la liste des systemes si une boite intersecte la presente boite</span>
00065   vectorSysteme tabSystemes = simuPere-&gt;getTabSystemes();
00066   vectorSysteme::iterator itSys;
00067   Systeme * sys;
00068   <span class="keywordflow">for</span> (itSys = tabSystemes.begin();itSys!=tabSystemes.end();++itSys)
00069   {
00070     sys = *itSys;
00071     Contour * pContourSys;
00072     pContourSys = sys-&gt;getPt_Contour();
00073     <span class="keywordflow">if</span> (pContourSys != <span class="keyword">this</span>)
00074     {
00075       vectorSegment2D contourSystCourantReferentielTerrain;
00076       vectorSegment2D contourSystCourant = pContourSys-&gt;tabSegments_Contour;
00077       <span class="keywordflow">for</span> (it = contourSystCourant.begin();it!=contourSystCourant.end();++it)
00078       {
00079         seg = *it;
00080         segRT = seg-&gt;creeSegmentRT(sys-&gt;getPositionCourante(),sys-&gt;getAttitudeCourante_rad());
00081         contourSystCourantReferentielTerrain.push_back(segRT);
00082       }
00083       Boite2D * boiteContourCourantRT = <span class="keyword">new</span> Boite2D(contourSystCourantReferentielTerrain);
00084           
00085       <span class="keywordflow">if</span> (boiteContourRT-&gt;IntersectionAvecBoite(boiteContourCourantRT))
00086       {
00087         log &lt;&lt; tempsCourant_ms &lt;&lt;<span class="stringliteral">"\t"</span>&lt;&lt; <span class="stringliteral">"intersection"</span> &lt;&lt;endl;
00088         intersection = <span class="keyword">true</span>;
00089       }
00090       <span class="keywordflow">else</span>
00091       {
00092         log &lt;&lt; tempsCourant_ms &lt;&lt;<span class="stringliteral">"\t"</span>&lt;&lt; <span class="stringliteral">" pas intersection"</span> &lt;&lt;endl;
00093         intersection = <span class="keyword">false</span>;
00094       }
00095       <span class="keyword">delete</span> boiteContourCourantRT;
00096       <span class="keywordflow">for</span> (it = contourSystCourantReferentielTerrain.begin();it!=contourSystCourantReferentielTerrain.end();++it)
00097       {
00098         segRT = *it;
00099         <span class="keyword">delete</span> segRT;
00100       }
00101     }
00102   }
00103 
00104   <span class="comment">//recherche plus precise de l'intersection  </span>
00105   
00106   <span class="comment">//recherche si contact avec un obstacle</span>
00107   
00108   <span class="comment">//recherche plus precise de l'intersection</span>
00109   
00110   <span class="comment">//Pour chaque intersection avec un systeme different  </span>
00111        <span class="comment">//recherche du point de contact</span>
00112   
00113   <span class="keyword">delete</span> boiteContourRT;
00114   <span class="keywordflow">for</span> (it = contourReferentielTerrain.begin();it!=contourReferentielTerrain.end();++it)
00115   {
00116     segRT = *it;
00117     <span class="keyword">delete</span> segRT;
00118   }
00119   message = <span class="stringliteral">"fin"</span>;
00120   trace-&gt;print(src,cl,<span class="stringliteral">"execute"</span>,message);
00121 }
00122 
00123 
00124 <span class="keywordtype">void</span> Contour::chargerXML(TiXmlElement* pModuleXML)
00125 {
00126   message = <span class="stringliteral">"debut"</span>;
00127   trace-&gt;print(src,cl,<span class="stringliteral">"chargerXML"</span>,message);
00128   Senseur::chargerXML(pModuleXML);
00129   
00130   TiXmlHandle handleModule(0);
00131   handleModule = TiXmlHandle(pModuleXML);
00132 
00133   <span class="comment">//chargement des segments</span>
00134   TiXmlElement* pSeg = handleModule.FirstChildElement(<span class="stringliteral">"Segment2D"</span>).Element();
00135   <span class="keywordflow">for</span>( pSeg; pSeg; pSeg=pSeg-&gt;NextSiblingElement(<span class="stringliteral">"Segment2D"</span>))
00136   {
00137     Segment2D * s2D = <span class="keyword">new</span> Segment2D(pSeg);
00138     message = <span class="stringliteral">"segment"</span>;
00139     trace-&gt;print(src,cl,<span class="stringliteral">"chargerXML"</span>,message);
00140     tabSegments_Contour.push_back(s2D);
00141   }
00142     
00143   message = <span class="stringliteral">"fin"</span>;
00144   trace-&gt;print(src,cl,<span class="stringliteral">"chargerXML"</span>,message);
00145 }
00146 
00147 <span class="keywordtype">void</span> Contour::connectModules(<span class="keywordtype">void</span>)
00148 {
00149   message = <span class="stringliteral">"debut"</span>;
00150   trace-&gt;print(src,cl,<span class="stringliteral">"connectModules"</span>,message);
00151   
00152   message = <span class="stringliteral">"fin"</span>;
00153   trace-&gt;print(src,cl,<span class="stringliteral">"connectModules"</span>,message);
00154 }
00155 <span class="keywordtype">bool</span> Contour::intersectionEnCours(<span class="keywordtype">void</span>)
00156 {
00157   <span class="keywordflow">return</span> intersection;
00158 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Thu Apr 27 10:54:52 2006 for SIMULATEUR by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
