<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>SIMULATEUR: algoPC.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="files.html">File&nbsp;List</a>  | <span class="search"><u>S</u>earch&nbsp;for&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<h1>algoPC.cpp</h1><pre class="fragment"><div>00001 <span class="preprocessor">#include "module.h"</span>
00002 <span class="preprocessor">#include "algo.h"</span>
00003 <span class="preprocessor">#include "algoPC.h"</span>
00004 <span class="preprocessor">#include "systeme.h"</span>
00005 <span class="preprocessor">#include "trace.h"</span>
00006 <span class="preprocessor">#include "tinyxml.h"</span>
00007 <span class="preprocessor">#include "comSeriePC_PIC.h"</span>
00008 <span class="preprocessor">#include "geom2D.h"</span>
00009 <span class="preprocessor">#include &lt;math.h&gt;</span>
00010 
00011 <span class="keyword">using</span> <span class="keyword">namespace </span>std;
00012 
00013 AlgoPC::AlgoPC(Systeme *s,Trace * t):Algo(s,t)
00014 {
00015   trace = t;
00016   src = <span class="stringliteral">"algoPC.cpp"</span>;
00017   cl = <span class="stringliteral">"AlgoPC"</span>;
00018   message = <span class="stringliteral">"debut"</span>;
00019   trace-&gt;print(src,cl,<span class="stringliteral">"AlgoPC"</span>,message);
00020   tempsDerniereExecution_ms = -100000;
00021   message = <span class="stringliteral">"fin"</span>;
00022   trace-&gt;print(src,cl,<span class="stringliteral">"AlgoPC"</span>,message);
00023 }
00024 
00025 AlgoPC::~AlgoPC(<span class="keywordtype">void</span>)
00026 {
00027   message = <span class="stringliteral">"debut"</span>;
00028   trace-&gt;print(src,cl,<span class="stringliteral">"~AlgoPC"</span>,message);
00029   message = <span class="stringliteral">"fin"</span>;
00030   trace-&gt;print(src,cl,<span class="stringliteral">"~AlgoPC"</span>,message);
00031 }
00032 
00033 <span class="keywordtype">void</span> AlgoPC::execute(<span class="keywordtype">int</span> tempsCourant_ms)
00034 {
00035   message = <span class="stringliteral">"debut"</span>;
00036   trace-&gt;print(src,cl,<span class="stringliteral">"execute"</span>,message);
00037   
00038   <span class="keywordflow">if</span> ((tempsCourant_ms - tempsDerniereExecution_ms) &gt;= 1000/(frequenceExecution_Hz))
00039   {
00040     <span class="keywordflow">if</span> (comSerie-&gt;tramePIC_PC_recue())
00041     {
00042       TramePIC_PC * trameRecue;
00043       trameRecue = comSerie-&gt;getTramePIC_PC();
00044       <span class="comment">//lecture trame et sauvegarde des données en local</span>
00045       <span class="keyword">delete</span> trameRecue;
00046     }
00047     
00048     <span class="comment">//traitements</span>
00049     
00050     <span class="comment">//création d'une trame pour les PICs</span>
00051     TramePC_PIC * trameEnvoyee = <span class="keyword">new</span> TramePC_PIC();
00052     trameEnvoyee-&gt;numeroSequenceWP = numeroSequenceWP;
00053     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> indWP = 0;indWP &lt; listeWP.size();indWP++)
00054     {
00055       <span class="comment">//recopie des wp dans la trame</span>
00056       WayPoint * wp = <span class="keyword">new</span> WayPoint(listeWP[indWP]-&gt;pt-&gt;x,
00057                                    listeWP[indWP]-&gt;pt-&gt;y,
00058                                    listeWP[indWP]-&gt;attitude_rad,
00059                                    listeWP[indWP]-&gt;vitesse_m_par_s);
00060       trameEnvoyee-&gt;tabWayPoint.push_back(wp);
00061     } 
00062     cout &lt;&lt; <span class="stringliteral">"trameEnvoyee "</span>&lt;&lt;trameEnvoyee&lt;&lt;endl;
00063     cout &lt;&lt; <span class="stringliteral">"listeWP "</span>&lt;&lt;&amp;(trameEnvoyee-&gt;tabWayPoint)&lt;&lt;endl;
00064     comSerie-&gt;sendToPIC(trameEnvoyee);
00065     
00066     tempsDerniereExecution_ms = tempsCourant_ms;
00067     log &lt;&lt; tempsCourant_ms &lt;&lt; endl;
00068   }
00069   
00070   message = <span class="stringliteral">"fin"</span>;
00071   trace-&gt;print(src,cl,<span class="stringliteral">"execute"</span>,message);
00072 }
00073 
00074 <span class="keywordtype">void</span> AlgoPC::chargerXML(TiXmlElement* pModuleXML)
00075 {
00076   message = <span class="stringliteral">"debut"</span>;
00077   trace-&gt;print(src,cl,<span class="stringliteral">"chargerXML"</span>,message);
00078   Algo::chargerXML(pModuleXML);
00079       
00080   TiXmlElement* pElt;
00081   TiXmlHandle handleModule(0);
00082   handleModule = TiXmlHandle(pModuleXML);
00083   
00084   pElt = handleModule.FirstChild(<span class="stringliteral">"frequenceExecution_Hz"</span>).Element();
00085   istringstream iss( pElt-&gt;GetText() );
00086   iss &gt;&gt; frequenceExecution_Hz;
00087   message = <span class="stringliteral">"frequenceExecution_Hz : "</span> + iss.str();
00088   trace-&gt;print(src,cl,<span class="stringliteral">"chargerXML"</span>,message);
00089 
00090   pElt = handleModule.FirstChild(<span class="stringliteral">"numeroSeqWP"</span>).Element();
00091   istringstream iss1( pElt-&gt;GetText() );
00092   iss1 &gt;&gt; numeroSequenceWP;
00093   message = <span class="stringliteral">"numeroSequenceWP : "</span> + iss1.str();
00094   trace-&gt;print(src,cl,<span class="stringliteral">"chargerXML"</span>,message);
00095   
00096   <span class="comment">//chargement des segments</span>
00097   TiXmlElement* pWP = handleModule.FirstChildElement(<span class="stringliteral">"wayPoint"</span>).Element();
00098   <span class="keywordflow">for</span>( pWP; pWP; pWP=pWP-&gt;NextSiblingElement(<span class="stringliteral">"wayPoint"</span>))
00099   {
00100     WayPoint * wp = <span class="keyword">new</span> WayPoint(pWP);
00101     listeWP.push_back(wp);
00102   }
00103   message = <span class="stringliteral">"fin"</span>;
00104   trace-&gt;print(src,cl,<span class="stringliteral">"chargerXML"</span>,message);
00105 }
00106 
00107 <span class="keywordtype">void</span> AlgoPC::connectModules(<span class="keywordtype">void</span>)
00108 {
00109   message = <span class="stringliteral">"debut"</span>;
00110   trace-&gt;print(src,cl,<span class="stringliteral">"connectModules"</span>,message);
00111   
00112   string nomModule;
00113   vectorString::iterator it;
00114   it = tabRelation.begin();
00115   <span class="keywordflow">if</span> (tabRelation.size() == 1)
00116   {
00117     nomModule = *it;
00118     comSerie = (ComSeriePC_PIC *)systPere-&gt;getPtrModule(nomModule);
00119     message = <span class="stringliteral">"connection à :"</span> + nomModule;
00120     trace-&gt;print(src,cl,<span class="stringliteral">"connectModules"</span>,message);
00121   }
00122   
00123   message = <span class="stringliteral">"fin"</span>;
00124   trace-&gt;print(src,cl,<span class="stringliteral">"connectModules"</span>,message);
00125 }
00126 
00127 
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Thu Apr 27 10:54:52 2006 for SIMULATEUR by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
